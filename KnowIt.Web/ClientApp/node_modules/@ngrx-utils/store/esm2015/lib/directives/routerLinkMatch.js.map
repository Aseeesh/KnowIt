{"version":3,"file":"routerLinkMatch.js","sourceRoot":"ng://@ngrx-utils/store/","sources":["lib/directives/routerLinkMatch.ts"],"names":[],"mappings":"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","sourcesContent":["import { ContentChildren, Directive, Input, NgModule } from '@angular/core';\nimport type {\n  QueryList,\n  AfterContentInit,\n  ElementRef,\n  OnChanges,\n  OnDestroy,\n  Renderer2,\n} from '@angular/core';\nimport {\n  NavigationEnd,\n  Router,\n  RouterLink,\n  RouterLinkWithHref,\n} from '@angular/router';\nimport { untilDestroy } from '../operators';\n\nexport interface MatchExp {\n  [classes: string]: string;\n}\n\n/**\n * This directive will give you ability to add a class to the element\n * when router url match a regular expression.\n * The syntax is same with ngClass but replace the true/false expression\n * with your string based regexp (like the string you pass to new RegExp(''))\n *\n * @example\n * Example: active-class will be added to a tag when router URL\n * contains this segment: products/12345\n *\n * ```html\n * <a routerLink=\"/products\"\n *  [routerLinkMatch]=\"{\n *    \"active-class\": \"products/\\\\d+\"\n *  }\"></a>\n * ```\n */\n@Directive({\n  selector: '[routerLinkMatch]',\n})\nexport class RouterLinkMatch implements OnDestroy, OnChanges, AfterContentInit {\n  private _curRoute: string;\n  private _matchExp: MatchExp;\n\n  @ContentChildren(RouterLink, { descendants: true })\n  links: QueryList<RouterLink>;\n\n  @ContentChildren(RouterLinkWithHref, { descendants: true })\n  linksWithHrefs: QueryList<RouterLinkWithHref>;\n\n  @Input('routerLinkMatch')\n  set routerLinkMatch(matchExp: MatchExp) {\n    if (matchExp && typeof matchExp === 'object') {\n      this._matchExp = matchExp;\n    } else {\n      throw new TypeError(\n        `Unexpected type '${typeof matchExp}' of value for ` +\n          `input of routerLinkMatch directive, expected 'object'`\n      );\n    }\n  }\n\n  constructor(\n    private router: Router,\n    private _renderer: Renderer2,\n    private _ngEl: ElementRef\n  ) {\n    router.events.pipe(untilDestroy(this)).subscribe((e) => {\n      if (e instanceof NavigationEnd) {\n        this._curRoute = (e as NavigationEnd).urlAfterRedirects;\n        this._update();\n      }\n    });\n  }\n\n  ngOnChanges() {\n    this._update();\n  }\n\n  ngAfterContentInit() {\n    this.links.changes.pipe(untilDestroy(this)).subscribe(() => this._update());\n    this.linksWithHrefs.changes\n      .pipe(untilDestroy(this))\n      .subscribe(() => this._update());\n    this._update();\n  }\n\n  private _update(): void {\n    if (!this.links || !this.linksWithHrefs || !this.router.navigated) {\n      return;\n    }\n\n    /**\n     * This a way of causing something to happen in the next micro-task / during a new round\n     * of change detection.\n     */\n    Promise.resolve().then(() => {\n      const matchExp = this._matchExp;\n\n      for (const classes of Object.keys(matchExp)) {\n        if (matchExp[classes] && typeof matchExp[classes] === 'string') {\n          const regexp = new RegExp(matchExp[classes]);\n          if (this._curRoute.match(regexp)) {\n            this._toggleClass(classes, true);\n          } else {\n            this._toggleClass(classes, false);\n          }\n        }\n      }\n    });\n  }\n\n  private _toggleClass(classes: string, enabled: boolean): void {\n    classes\n      .split(/\\s+/g)\n      .filter((cls) => !!cls)\n      .forEach((cls) => {\n        if (enabled) {\n          this._renderer.addClass(this._ngEl.nativeElement, cls);\n        } else {\n          this._renderer.removeClass(this._ngEl.nativeElement, cls);\n        }\n      });\n  }\n\n  ngOnDestroy() {}\n}\n\n@NgModule({\n  declarations: [RouterLinkMatch],\n  exports: [RouterLinkMatch],\n})\nexport class RouterLinkMatchModule {}\n"]}